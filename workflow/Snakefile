#snakemake --dag | dot -Tsvg > dag.svg
# ======== WORKFLOW CONFIG =========
# - Config file -
configfile: "workflow/config.yaml"  # Parameter config
_network = config["network"]

# - Pathing -
_path = config["workflow"]["pathing"]
SRC = _path["SRC"]  # Project code
TMP = _path["TMP"]  # Temporary generated file storage
RAW = _path["RAW"]  # Experiment results
PROCESSED = _path["PROCESSED"]  # Post-processed experiment results
FIGURES = _path["FIGURES"]  # Data visualization

# - Datafiles -
_path = config["workflow"]["datafiles"]
KEEP_EMBEDDINGS = _path["KEEP_EMBEDDINGS"]  # Flag on saving embeddings to file
TEMPLATE = _path["TEMPLATE"]  # Data file template

# =========== WORKFLOW ===========
# ----- All rule ----
rule all:
    input:
        expand(
            TMP + \
            "raw_N={N}_gamma={gamma}_kmin={kmin}_prob={prob}_sign={sign}_pfi={pfi}_repetition={repetition}.pkl",
            N = _network["N"], gamma = _network["gamma"], kmin = _network["kmin"],
            prob = _network["prob"], sign = _network["sign"], pfi = _network["pfi"],
            repetition = _network["repetition"]
        )
    output:
        RAW + "EMB_ex01_node2vec.csv"
    shell:
        "touch {output}"


# ----- Computation rules -----
rule embedded_reconstruction:
    output:
        TMP + \
            "raw_N={N}_gamma={gamma}_kmin={kmin}_prob={prob}_sign={sign}_pfi={pfi}_repetition={repetition}.pkl"
    params:
        save_embeddings = KEEP_EMBEDDINGS,
        config_embedding = config["embedding"]
    script:
        SRC + "EMB_ex01_workflow.py"
